# 观我生 - 诗歌在场 (含后台管理)

这是一个结合了心理测试与诗歌生成的互动网页应用。用户通过回答一系列问题，最终会得到一首与他们心境相匹配的现代诗。本项目在原有功能基础上，增加了一个简单的后台管理系统，用于动态编辑和管理诗歌库与测试问题。

## 功能特性

- **前端应用 (Quiz App)**:
    - 一个包含可配置数量问题的心理测试。
    - 根据用户的选择组合，匹配并展示一首专属诗歌。
    - 集成Gemini API，提供"解诗"和"读诗"的AI功能。
    - 包含一个调试模式，方便开发者追踪应用状态。

- **后台管理 (Admin Panel)**:
    - **诗歌管理**: 在管理页面 (`/admin.html`) 中，可以对诗歌进行增、删、改、查操作。
    - **问题管理**: 在管理页面 (`/admin-questions.html`) 中，可以编辑测试问题和选项。
    - **映射管理**: 在管理页面 (`/admin-mapping.html`) 中，可以配置问题答案与诗歌的映射关系。
    - **目录视图**: 左侧边栏会实时展示 `poems` 文件夹下的所有诗歌文件和子目录。
    - **文本编辑**: 提供一个简洁的文本编辑区域，用于修改和撰写诗歌内容。
    - **持久化存储**: 所有诗歌都作为独立的 `.txt` 文件保存在服务器的 `poems/` 目录下，方便管理和备份。
    - **测试单元**: 支持创建多个测试单元，每个单元包含一组问题和对应的诗歌集合。

## 技术架构

本项目采用轻量级的 `Node.js` + `Express` 作为后端，为纯静态的前端页面提供数据接口和文件操作能力。

- **后端**: Node.js 运行时, Express 框架。
- **前端**: HTML, Tailwind CSS, 原生 JavaScript。
- **数据存储**:
  - 诗歌以 `.txt` 格式的文件存储在服务器本地的 `/poems` 文件夹中。
  - 问题和映射关系以 JSON 格式存储在 `/data` 文件夹中。

## 项目结构

```
.
├── poems/                  # 存放所有诗歌.txt文件
│   ├── 观我生/             # 默认单元
│   │   ├── 《论保持希望》.txt
│   │   └── ... (其他诗歌)
│   └── 其他单元/           # 可以创建其他单元
├── data/                   # 存放配置数据
│   ├── questions.json      # 存储所有问题和选项
│   └── mappings.json       # 存储答案与诗歌的映射关系
├── public/                 # 存放所有前端静态资源
│   ├── index.html          # 主应用(心理测试)页面
│   ├── admin.html          # 诗歌管理页面
│   ├── admin-questions.html # 问题管理页面
│   ├── admin-mapping.html  # 映射管理页面
│   ├── admin.js            # 诗歌管理页面的逻辑脚本
│   ├── admin-questions.js  # 问题管理页面的逻辑脚本
│   └── admin-mapping.js    # 映射管理页面的逻辑脚本
├── package.json            # 项目依赖与脚本配置
└── server.js               # Node.js Express服务器主文件
```

## 安装与启动

**环境要求**:
- [Node.js](https://nodejs.org/) (建议LTS版本)
- npm (通常随Node.js一同安装)

**步骤**:
1.  **克隆或下载项目到本地。**

2.  **安装依赖**:
    打开终端，进入项目根目录，运行以下命令：
    ```bash
    npm install
    ```

3.  **启动服务器**:
    ```bash
    node server.js
    ```
    启动成功后，你会在终端看到类似 `Server running at http://localhost:3000` 的提示。

4.  **访问应用**:
    - **心理测试主页**: 在浏览器中打开 `http://localhost:3000`
    - **诗歌管理页面**: 在浏览器中打开 `http://localhost:3000/admin.html`
    - **问题管理页面**: 在浏览器中打开 `http://localhost:3000/admin-questions.html`
    - **映射管理页面**: 在浏览器中打开 `http://localhost:3000/admin-mapping.html`

## 测试单元与映射配置

系统支持创建多个测试单元，每个单元由一组问题和对应的诗歌集合组成。在本系统中，每个子文件夹即为一个测试单元。映射规则如下：

1. 每个问题有两个选项（A和B），可以编码为二进制位（0和1）
2. N个问题可以组成2^N种不同的答案组合
3. 每种答案组合对应到一首特定的诗歌
4. 映射表以表格形式呈现，行为诗歌，列为问题答案组合

例如，对于4个问题，共有16种可能的答案组合（从AAAA到BBBB），对应16首不同的诗歌。

## API 端点说明 (供参考)

后台服务器提供了以下API端点来支持前后端交互：

- `GET /api/poems-all`:
  - **功能**: 获取所有诗歌，并以主应用所需的 `{'标题': '内容', ...}` JSON格式返回。
  - **用途**: `index.html` 页面加载时调用，以获取测试所需的所有诗歌数据。

- `GET /api/poems-tree`:
  - **功能**: 获取 `poems` 目录的层级结构（包含文件和文件夹）。
  - **用途**: `admin.html` 页面加载时调用，用于渲染左侧的诗歌目录树。

- `GET /api/questions`:
  - **功能**: 获取所有测试问题和选项。
  - **用途**: `index.html` 和 `admin-questions.html` 页面加载时调用。

- `GET /api/mappings`:
  - **功能**: 获取答案组合与诗歌的映射关系。
  - **用途**: `index.html` 和 `admin-mapping.html` 页面加载时调用。

- `PUT /api/questions`:
  - **功能**: 更新测试问题和选项。
  - **请求体**: 包含所有问题和选项的JSON数组。
  - **用途**: 在问题管理页面，保存对问题的修改。

- `PUT /api/mappings`:
  - **功能**: 更新答案组合与诗歌的映射关系。
  - **请求体**: 包含映射关系的JSON对象。
  - **用途**: 在映射管理页面，保存对映射的修改。

- 其他诗歌相关API端点（与之前相同） 