@echo off
:: =================================================================
:: “陆家花园”一键启动脚本 (Windows) - 极简稳定版
:: 作者：陆家明
:: 版本：2.1
::
:: 核心逻辑：
:: - 使用 "call" 命令确保在执行完 npm 命令后，控制权能返回脚本。
:: - 在同一个窗口中，按顺序执行 npm install 和 npm start。
:: - 保持窗口开启，以持续显示服务器日志。
:: - 当服务被手动停止后，窗口会暂停，防止立即退出。
:: =================================================================

:: 切换代码页以支持包含中文等非英文字符的路径
chcp 65001 > nul

:: 切换到脚本文件所在的目录，确保路径正确
cd /d "%~dp0"

:: 设置窗口标题
title 陆家花园 - 后院服务

echo.
echo ----------------------------------------------------
echo         正在准备启动“陆家花园”后院...
echo ----------------------------------------------------
echo.
echo [步骤 1/2] 正在同步“工料清单” (npm install)...
echo.

:: 使用 call 执行 npm install，确保执行完毕后能返回
call npm install

:: 检查上一个命令是否成功
if %errorlevel% neq 0 (
    echo.
    echo [错误] “工料清单”同步失败。请检查Node.js环境或网络。
    echo.
    pause
    exit /b
)

echo.
echo [成功] “工料清单”已是最新。
echo.
echo ----------------------------------------------------
echo [步骤 2/2] 正在启动后院服务 (npm start)...
echo (服务启动后，此窗口将显示实时日志)
echo (要停止服务，请在此窗口按下 Ctrl+C)
echo ----------------------------------------------------
echo.

:: 使用 call 执行 npm start
call npm start

:: 当上面的 npm start 命令被用户用 Ctrl+C 终止后，脚本会继续执行到这里
echo.
echo ----------------------------------------------------
echo [通知] “陆家花园”后院服务已由您手动停止。
echo ----------------------------------------------------
echo.
pause
